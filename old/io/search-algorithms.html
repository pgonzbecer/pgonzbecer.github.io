<!-- Created by Paul Gonzalez Becerra /-->

<!DOCTYPE html>

<html>
	<head>
		<style>
			body	{
				margin:	0px;
				font-family:	lucida console;
			}
			
			.radioheads	{
				position:	relative;
				top:	0px;
				height:	48px;
			}
			
			.radioheads_1	{
				position:	absolute;
				top:	0px;
				width:	25%;
			}
			
			.radioheads_2	{
				position:	absolute;
				left:	25%;
				width:	25%;
			}
			
			.radioheads_3	{
				position:	absolute;
				left:	50%;
				width:	25%;
			}
			
			#table	{
				padding:	4px;
				background-color:	black;
				position:	absolute;
				top:	64px;
				width:	10px;
				height:	10px;
			}
			
			.cell	{
				background-color:	white;
				width:	64px;
				height:	64px;
				margin:	6px;
			}
			.cell .dijkstra_path,
			.cell .astar_path_g,
			.cell .astar_path_h,
			.cell .astar_path_f,
			.cell .follow_path	{
				display:	block;
				position:	absolute;
				width:	24px;
				height:	16px;
				display:	none;
			}
			.cell .dijkstra_path	{
				color:	red;
				left:	20px;
				top:	24px;
				display:	block;
			}
			.cell .astar_path_h	{
				background-color:	lightblue;
				right:	4px;
				top:	4px;
			}
			.cell .astar_path_g	{
				background-color:	palegreen;
				left:	4px;
				bottom:	4px;
			}
			.cell .astar_path_f	{
				background-color:	pink;
				bottom:	4px;
				right:	4px;
			}
			.cell .follow_path	{
				color:	navy;
				top:	4px;
				left:	4px;
			}
		</style>
		<script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
		<title>Search Algorithms Demo</title>
		<script>
			// Variables
			var	docc=	null;
			var	grid=	null;
			var	selRadio=	0;
			var	astarStage=	{
				stage:	0,
				pos:	[]
			};
			var	areDiagonalsExcluded=	false;
			var	width=	0;
			var	height=	0;
			var	min=	1;
			var	max=	20;
			
			$(window).load(function(args)	{
				docc=	{
					table:	$("#table"),
					width:	$("#widthamt"),
					height:	$("#heightamt"),
					radio:	$(".search_algorithm"),
					movement:	$("#track_movement"),
					rsize:	$("#radius_size"),
					rnum:	$("#radius_num"),
					obsticles:	$("#obsticles"),
					diagonals:	$("#diagonals")
				};
				
				docc.width.keyup(onChangeTableSize);
				docc.height.keyup(onChangeTableSize);
				docc.obsticles.change(onChangeTableSize);
				docc.radio.click(onChangeAlgorithm);
				docc.rsize.change(onResetRadius).mousemove(onResetRadius);
				docc.diagonals.change(function(args)	{
					areDiagonalsExcluded=	args.target.checked;
				});
				$(window).mousemove(function(args)	{
					args.isMouseMovement=	true;
					onMoveClick(args);
				});
				$(window).click(function(args)	{
					args.isMouseMovement=	false;
					onMoveClick(args);
				});
				
				
				docc.width.val(10);
				docc.height.val(10);
				docc.width.keyup();
			});
			
			// Called when the mouse has moved or clicked
			function onMoveClick(args)	{
				if(!args.isMouseMovement && docc.movement[0].checked)
					return;
				if(args.isMouseMovement && !docc.movement[0].checked)
					return;
				
				// Variables
				var	cell=	isWithinGrid(args.pageX, args.pageY);
				
				if(cell.id== -1)
					return;
				
				if(selRadio== 0)
				{
					destroyPaths();
					doDijkstraSearch(
						cell.x,
						cell.y,
						0,
						1*docc.rnum.text()
					);
					displayPaths("dijkstra");
				}
				else
				{
					if(args.isMouseMovement || grid[cell.id].getAttribute("is-obsticle"))
						return;
					
					if(astarStage.stage== 0)
					{
						astarStage.stage=	1;
						astarStage.pos=	[cell.x, cell.y];
						destroyPaths();
					}
					else
					{
						// Variables
						var	traversed=	[];
						
						astarStage.stage=	0;
						traversed=	doAStarSearch(
							astarStage.pos[0],
							astarStage.pos[1],
							[cell.x, cell.y]
						);
						for(var i= 0; i< traversed.length; i++)
						{
							grid[getPosition(traversed[i].x, traversed[i].y)].style.backgroundColor=	"black";
						}
						displayPaths("astar");
					}
				}
			}
			
			// Destroys the paths
			function destroyPaths()	{
				grid.each(function(index, elem)	{
					elem.dpath=	-1;
					elem.apath=	[0, 0, 0];
					elem.parent=	null;
					$(elem).find(".dijkstra_path").html(-1);
					$(elem).find(".astar_path_g").html(0);
					$(elem).find(".astar_path_h").html(0);
					$(elem).find(".astar_path_f").html(0);
					if(elem.getAttribute("is-obsticle"))
						elem.style.backgroundColor=	"brown";
					else
						elem.style.backgroundColor=	"white";
				});
			}
			
			// Displays the paths
			function displayPaths(idname)
			{
				if(idname== "dijkstra")
				{
					grid.each(function(index, elem)	{
						$(elem).find(".dijkstra_path").html(elem.dpath);
					});
				}
				else
				{
					grid.each(function(index, elem)	{
						$(elem).find(".astar_path_g").html(Math.round(elem.apath[0]));
						$(elem).find(".astar_path_h").html(Math.round(elem.apath[1]));
						$(elem).find(".astar_path_f").html(Math.round(elem.apath[2]));
					});
				}
			}
			
			// Does a dijkstra search
			function doDijkstraSearch(x, y, radius, maxRad)	{
				if(dijkstra_canStopSearch(x, y, radius, maxRad))
					return;
				
				grid[getPosition(x, y)].dpath=	radius;
				grid[getPosition(x, y)].style.backgroundColor=	"paleturquoise";
				
				doDijkstraSearch(x, y+1, radius+1, maxRad);
				doDijkstraSearch(x+1, y, radius+1, maxRad);
				doDijkstraSearch(x, y-1, radius+1, maxRad);
				doDijkstraSearch(x-1, y, radius+1, maxRad);
			}
			
			// Finds if the search cannot search anymore
			function dijkstra_canStopSearch(x, y, radius, maxRad)	{
				if(x< 0 || x>= width)
					return true;
				if(y< 0 || y>= height)
					return true;
				if(radius> maxRad)
					return true;
				if(grid[getPosition(x, y)].getAttribute("is-obsticle"))
					return true;
				if(grid[getPosition(x, y)].dpath< radius && grid[getPosition(x, y)].dpath!= -1)
					return true;
				
				return false;
			}
			
			// Does an A* search
			function doAStarSearch(x, y, goal)	{
				// Variables
				var	opened=	[];
				var	closed=	[];
				var	lowestIndex;
				var	currNode;
				var	neighbors;
				
				opened.push(grid[getPosition(x, y)]);
				
				while(opened.length> 0)
				{
					lowestIndex=	0;
					for(var i= 0; i< opened.length; i++)
					{
						if(opened[i].apath[2]< opened[lowestIndex].apath[2])
							lowestIndex=	i;
					}
					currNode=	opened[lowestIndex];
					opened=	remove(opened, currNode);
					closed.push(currNode);
					
					if(
						currNode.x== grid[getPosition(goal[0], goal[1])].x &&
						currNode.y== grid[getPosition(goal[0], goal[1])].y
					)
					{
						// Variables
						var	curr=	currNode;
						var	traversed=	[];
						
						curr.style.backgroundColor=	"darkgreen";
						
						while(curr.parent)	{
							traversed.push(curr);
							curr=	grid[getPosition(curr.parent[0], curr.parent[1])];
						}
						
						return traversed.reverse();
					}
					
					neighbors=	getNeighbors(currNode);
					
					for(var i= 0; i< neighbors.length; i++)
					{
						
						if(contains(closed, neighbors[i]) || neighbors[i].getAttribute("is-obsticle"))
							continue;
						
						if(neighbors[i].apath[2]< currNode.apath[2] || !contains(opened, neighbors[i]))
						{
							neighbors[i].parent=	[currNode.x, currNode.y];
							neighbors[i].apath[0]=	neighbors[i].gval;
							neighbors[i].apath[1]=	getHeuristic(neighbors[i], grid[getPosition(goal[0], goal[1])]);
							neighbors[i].apath[2]=	neighbors[i].apath[0]+neighbors[i].apath[1];
							if(!contains(opened, neighbors[i]))
								opened.push(neighbors[i]);
							neighbors[i].style.backgroundColor=	"darkgreen";
						}
					}
				}
				
				return [];
			}
			
			// Gets the distance between the two nodes
			function getHeuristic(nodeA, nodeB)	{
				// Variables
				var	dx=	Math.abs(nodeB.x-nodeA.x);
				var	dy=	Math.abs(nodeB.y-nodeA.y);
				
				return (dx+dy);
			}
			
			// Gets the successors of q
			function getNeighbors(q)	{
				// Variables
				var	x=	q.x;
				var	y=	q.y;
				var	successors=	[];
				var	k=	0;
				
				for(var h= 0; h< 8; h++)
				{
					switch(h)
					{
						case 0: // Up
							if(y+1< height)
							{
								if(!grid[getPosition(x, y+1)].getAttribute("is-obsticle"))
								{
									successors[k++]=	grid[getPosition(x, y+1)];
									successors[k-1].gval=	10;
								}
							}
							break;
						case 1: // Up-right
							if(docc.diagonals[0].checked)
								break;
							if(x+1< width && y+1< height)
							{
								if(!grid[getPosition(x+1, y+1)].getAttribute("is-obsticle"))
								{
									successors[k++]=	grid[getPosition(x+1, y+1)];
									successors[k-1].gval=	14;
								}
							}
							break;
						case 2: // Right
							if(x+1< width)
							{
								if(!grid[getPosition(x+1, y)].getAttribute("is-obsticle"))
								{
									successors[k++]=	grid[getPosition(x+1, y)];
									successors[k-1].gval=	10;
								}
							}
							break;
						case 3: // Down-right
							if(docc.diagonals[0].checked)
								break;
							if(x+1< width && y-1>= 0)
							{
								if(!grid[getPosition(x+1, y-1)].getAttribute("is-obsticle"))
								{
									successors[k++]=	grid[getPosition(x+1, y-1)];
									successors[k-1].gval=	14;
								}
							}
							break;
						case 4: // Down
							if(y-1>= 0)
							{
								if(!grid[getPosition(x, y-1)].getAttribute("is-obsticle"))
								{
									successors[k++]=	grid[getPosition(x, y-1)];
									successors[k-1].gval=	10;
								}
							}
							break;
						case 5: // Down-left
							if(docc.diagonals[0].checked)
								break;
							if(x-1>= 0 && y-1>= 0)
							{
								if(!grid[getPosition(x-1, y-1)].getAttribute("is-obsticle"))
								{
									successors[k++]=	grid[getPosition(x-1, y-1)];
									successors[k-1].gval=	14;
								}
							}
							break;
						case 6: // Left
							if(x-1>= 0)
							{
								if(!grid[getPosition(x-1, y)].getAttribute("is-obsticle"))
								{
									successors[k++]=	grid[getPosition(x-1, y)];
									successors[k-1].gval=	10;
								}
							}
							break;
						case 7: // Up-left
							if(docc.diagonals[0].checked)
								break;
							if(x-1>= 0 && y+1< height)
							{
								if(!grid[getPosition(x-1, y+1)].getAttribute("is-obsticle"))
								{
									successors[k++]=	grid[getPosition(x-1, y+1)];
									successors[k-1].gval=	14;
								}
							}
							break;
					}
				}
				
				return successors;
			}
			
			// Removes the item from the list
			function remove(list, item)	{
				for(var i= 0; i< list.length; i++)
				{
					if(list[i]== item)
					{
						list.splice(i);
						break;
					}
				}
				
				return list;
			}
			
			// Finds if the given item is contained within the given list
			function contains(list, item)	{
				for(var i= 0; i< list.length; i++)
				{
					if(list[i]== item)
						return true;
				}
				
				return false;
			}
			
			// Gets the position of the cell given it's xy coordinates
			function getPosition(x, y)	{
				return x+y*width;
			}
			
			// Called when the algorithm has changed
			function onChangeAlgorithm(args)	{
				destroyPaths();
				switch(args.target.getAttribute("idname"))
				{
					case "dijkstra":
						selRadio=	0;
						grid.find(".dijkstra_path").css({display: "block"});
						grid.find(".astar_path_g").css({display: "none"});
						grid.find(".astar_path_h").css({display: "none"});
						grid.find(".astar_path_f").css({display: "none"});
						break;
					case "astar":
						selRadio=	1;
						grid.find(".dijkstra_path").css({display: "none"});
						grid.find(".astar_path_g").css({display: "block"});
						grid.find(".astar_path_h").css({display: "block"});
						grid.find(".astar_path_f").css({display: "block"});
						break;
				}
			}
			
			// Called when the radius has been reset
			function onResetRadius(args)	{
				docc.rnum.text(parseInt(13*(args.target.value/100)+3));
			}
			
			// Called when the table's size needs to be reset
			function onChangeTableSize(args)	{
				try	{
					if(docc.width.val()< min)
					{
						docc.width.val(min);
						onChangeTableSize(args);
						return;
					}
					else if(docc.width.val()> max)
					{
						docc.width.val(max);
						onChangeTableSize(args);
						return;
					}
					
					if(docc.height.val()< min)
					{
						docc.height.val(min);
						onChangeTableSize(args);
						return;
					}
					else if(docc.height.val()> max)
					{
						docc.height.val(max);
						onChangeTableSize(args);
						return;
					}
					
					if(docc.width.val()== "")
						return;
					if(docc.height.val()== "")
						return;
				} catch(e) { return; }
				
				width=	1*docc.width.val();
				height=	1*docc.height.val();
				
				docc.table.html("").width(68*width).height(68*height);
				for(var h= 0; h< width; h++)
				{
					for(var k= 0; k< height; k++)
					{
						docc.table.html(
							docc.table.html()+
							"<div class='cell' data-x='"+k+"' data-y='"+h+"' style='"+getStyle(h, k)+
							((!docc.obsticles[0].checked && Math.random()< 0.25) ?
								"background-color:brown;' is-obsticle='true'"	:
								"'"
							)+">"+
							"<span class='dijkstra_path'>-1</span>"+
							"<span class='astar_path_g'>0</span>"+
							"<span class='astar_path_h'>0</span>"+
							"<span class='astar_path_f'>0</span>"+
							"</div>"
						);
					}
				}
				grid=	$(".cell");
				grid.each(function(index, elem)	{
					elem.dpath=	-1;
					elem.apath=	[0, 0, 0];
					elem.parent=	null;
					elem.x=	parseInt(elem.getAttribute("data-x"));
					elem.y=	parseInt(elem.getAttribute("data-y"));
				});
				$(docc.radio[selRadio]).click();
			}
			
			// Gets the style for the cell to position it juuust right
			function getStyle(x, y)	{
				return (
					"position:absolute;"+
					"top:"+(68*y)+"px;"+
					"left:"+(68*x)+"px;"
				);
			}
			
			// Finds if the given xy coordinates are within the grid
			function isWithinGrid(x, y)	{
				for(var i= 0; i< grid.length; i++)
				{
					if(x< grid[i].offsetLeft || x> grid[i].offsetLeft+grid[i].offsetWidth)
						continue;
					if(y< grid[i].offsetTop+64 || y> grid[i].offsetTop+grid[i].offsetHeight+64)
						continue;
					
					return {
						id:	i,
						x:	grid[i].x,
						y:	grid[i].y
					};
				}
				
				return {
					id:	-1
				};
			}
		</script>
	</head>
	<body>
		<div class="input">
			Width: <input type="text" placeholder="1-20" id="widthamt">
			Height: <input type="text" placeholder="1-20" id="heightamt"><br/>
			<div class="radioheads">
				<div class="radioheads_1">
					<input type="radio" checked="true" idname="dijkstra" name="search_algorithm" class="search_algorithm" />Dijkstra Search<br/>
					<input type="radio" idname="astar" name="search_algorithm" class="search_algorithm" />A* Search<br/>
				</div>
				<div class="radioheads_2">
					<input type="checkbox" id="track_movement" />Track Movement<br/>
					<input type="range" id="radius_size" value="10" /> <span id="radius_num">4</span>
				</div>
				<div class="radioheads_3">
					<input type="checkbox" id="obsticles" />No Obsticles<br/>
					<input type="checkbox" id="diagonals" />Exclude Diagonals<br/>
				</div>
			</div>
		</div>
		<div id="table"></div>
	</body>
</html>

<!-- End of File /-->